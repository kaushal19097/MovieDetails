<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management</title>
    <style>
        table{ width: 100%; border-collapse: collapse; margin-top: 20px;}
        th, td{ border: 1px solid black; padding: 10px; text-align: left;}
        th{ background-color: #f2f2f2;}
        form{ display: none; margin-top: 20px;}
    </style>
</head>
<body>
    <h2>User List</h2>
    <table id="userTable">
        <thead>
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <h2>Edit User</h2>
    <form id="editForm">
        <input type="hidden" id="userId">
        <label>Name: <input type="text" id="userName"></label><br><br>
        <label>Email: <input type="email" id="userEmail"></label><br><br>
        <button type="submit">Update</button>
        <button type="button" onclick="cancelEdit()">Cancel</button>
    </form>

    <script>
        const apiUrl="https://masaiassignment-17a4f-default-rtdb.firebaseio.com/users.json";
        fetchUsers();
        document.getElementById("editForm").addEventListener("submit", updateUser);

        function fetchUsers(){
            fetch(apiUrl)
                .then(response => response.json())
                .then(data =>{
                    const tbody=document.querySelector("#userTable tbody");
                    tbody.innerHTML="";

                    if (data){
                        Object.keys(data).forEach(id =>{
                            const user=data[id];
                            const row=document.createElement("tr");
                            row.innerHTML=`
                                <td>${user.name}</td>
                                <td>${user.email}</td>
                                <td><button onclick="editUser('${id}', '${user.name}', '${user.email}')">Edit</button></td>
                            `;

                            tbody.appendChild(row);
                       });
                   }
               })
                .catch(error => console.error("Error fetching users:", error));
       }

        function editUser(id, name, email){
            document.getElementById("userId").value=id;
            document.getElementById("userName").value=name;
            document.getElementById("userEmail").value=email;
            document.getElementById("editForm").style.display="block";
       }

        function updateUser(event){
            event.preventDefault();
            const id=document.getElementById("userId").value;
            const updatedUser={
                name: document.getElementById("userName").value,
                email: document.getElementById("userEmail").value
           };

            fetch(`https://masaiassignment-17a4f-default-rtdb.firebaseio.com/users/${id}.json`,{
                method: "PATCH",
                headers:{ "Content-Type": "application/json"},
                body: JSON.stringify(updatedUser)
           })
            .then(response => response.json())
            .then(() =>{
                fetchUsers();
                cancelEdit();
           })
            .catch(error => console.error("Error updating user:", error));
       }

        function cancelEdit(){
            document.getElementById("editForm").style.display="none";
            document.getElementById("userId").value="";
            document.getElementById("userName").value="";
            document.getElementById("userEmail").value="";
       }
    </script>

</body>
</html>
